2025-03-27 04:21:46,839 | amadeus_booking | INFO | 
===== BOOKING FLIGHT =====
2025-03-27 04:21:46,841 | amadeus_booking | INFO | Flight booking requested
2025-03-27 04:21:46,842 | amadeus_booking | ERROR | Missing traveler information: first_name, last_name
2025-03-27 04:22:05,107 | amadeus_booking | INFO | 
===== BOOKING FLIGHT =====
2025-03-27 04:22:05,108 | amadeus_booking | INFO | Flight booking requested
2025-03-27 04:22:05,108 | amadeus_booking | INFO | Getting Amadeus API access token
2025-03-27 04:22:06,036 | amadeus_booking | INFO | Got access token: i3xW7HZa3H...
2025-03-27 04:22:06,038 | amadeus_booking | WARNING | No previous search data available to find original offer
2025-03-27 04:22:06,038 | amadeus_booking | INFO | Creating flight offer from provided details
2025-03-27 04:22:06,040 | amadeus_booking | INFO | Created flight offer with carrier: AS, flight: AS435, from:  to: 
2025-03-27 04:22:06,041 | amadeus_booking | INFO | Booking payload: {
  "data": {
    "type": "flight-order",
    "flightOffers": [
      {
        "type": "flight-offer",
        "id": "1",
        "source": "GDS",
        "instantTicketingRequired": false,
        "nonHomogeneous": false,
        "lastTicketingDate": "2025-05-01",
        "itineraries": [
          {
            "segments": [
              {
                "departure": {
                  "iataCode": "",
                  "terminal": "",
                  "at": "2025-05-01T00:00:00"
                },
                "arrival": {
                  "iataCode": "",
                  "terminal": "",
                  "at": "2025-05-01T01:00:00"
                },
                "carrierCode": "AS",
                "number": "AS435",
                "aircraft": {
                  "code": "320"
                },
                "operating": {
                  "carrierCode": "AS"
                },
                "duration": "PT2H",
                "id": "1",
                "numberOfStops": 0
              }
            ]
          }
        ],
        "price": {
          "currency": "EUR",
          "total": "0.00",
          "base": "0.00",
          "grandTotal": "0.00"
        },
        "pricingOptions": {
          "fareType": [
            "PUBLISHED"
          ],
          "includedCheckedBagsOnly": false
        },
        "validatingAirlineCodes": [
          "AS"
        ],
        "travelerPricings": [
          {
            "travelerId": "1",
            "fareOption": "STANDARD",
            "travelerType": "ADULT",
            "price": {
              "currency": "EUR",
              "total": "0.00",
              "base": "0.00"
            },
            "fareDetailsBySegment": [
              {
                "segmentId": "1",
                "cabin": "ECONOMY",
                "fareBasis": "YFFBR",
                "class": "Y",
                "includedCheckedBags": {
                  "quantity": 0
                }
              }
            ]
          }
        ]
      }
    ],
    "travelers": [
      {
        "id": "1",
        "dateOfBirth": "2000-01-01",
        "name": {
          "firstName": "ak",
          "lastName": "ak"
        },
        "gender": "MALE",
        "contact": {
          "emailAddress": "ak@ak.com",
          "phones": [
            {
              "deviceType": "MOBILE",
              "countryCallingCode": "1",
              "number": "99999999"
            }
          ]
        }
      }
    ],
    "ticketingAgreement": {
      "option": "DELAY_TO_CANCEL",
      "delay": "6D"
    }
  }
}
2025-03-27 04:22:06,041 | amadeus_booking | INFO | Sending booking request to https://test.api.amadeus.com/v1/booking/flight-orders
2025-03-27 04:22:07,184 | amadeus_booking | INFO | Booking API response: HTTP 400
2025-03-27 04:22:07,186 | amadeus_booking | INFO | Raw API response saved to api_responses/booking_20250327_042207.txt
2025-03-27 04:22:07,187 | amadeus_booking | ERROR | API errors: Booking failed: departure iataCode must be a 3-letter code (Code: 477, Path: /data/flightOffers[0]/itineraries[0]/segments[0]/departure/iataCode); arrival iataCode must be a 3-letter code (Code: 477, Path: /data/flightOffers[0]/itineraries[0]/segments[0]/arrival/iataCode)
2025-03-27 04:22:07,187 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:07,190 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCNH3S_20250327_042207.json
2025-03-27 04:22:07,204 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:07,210 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:07,211 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:07,211 | amadeus_booking | ERROR | Booking failed with status code 400: {"errors":[{"status":400,"code":477,"title":"INVALID FORMAT","detail":"departure iataCode must be a 3-letter code","source":{"pointer":"/data/flightOffers[0]/itineraries[0]/segments[0]/departure/iataCode","example":"ORY"}},{"status":400,"code":477,"title":"INVALID FORMAT","detail":"arrival iataCode must be a 3-letter code","source":{"pointer":"/data/flightOffers[0]/itineraries[0]/segments[0]/arrival/iataCode","example":"ORY"}}]}
2025-03-27 04:22:07,211 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:07,214 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCAI25_20250327_042207.json
2025-03-27 04:22:07,215 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:07,216 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:07,217 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:07,217 | amadeus_booking | ERROR | Unexpected error: local variable 'random' referenced before assignment
2025-03-27 04:22:07,217 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:07,217 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCCRM7_20250327_042207.json
2025-03-27 04:22:07,218 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:07,218 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:07,219 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:07,219 | amadeus_booking | INFO | 
===== BOOKING FLIGHT =====
2025-03-27 04:22:07,219 | amadeus_booking | INFO | Flight booking requested
2025-03-27 04:22:07,219 | amadeus_booking | INFO | Getting Amadeus API access token
2025-03-27 04:22:07,922 | amadeus_booking | INFO | Got access token: hHHX9xkihH...
2025-03-27 04:22:07,922 | amadeus_booking | WARNING | No previous search data available to find original offer
2025-03-27 04:22:07,922 | amadeus_booking | INFO | Creating flight offer from provided details
2025-03-27 04:22:07,922 | amadeus_booking | INFO | Created flight offer with carrier: AS, flight: AS435, from:  to: 
2025-03-27 04:22:07,922 | amadeus_booking | INFO | Booking payload: {
  "data": {
    "type": "flight-order",
    "flightOffers": [
      {
        "type": "flight-offer",
        "id": "1",
        "source": "GDS",
        "instantTicketingRequired": false,
        "nonHomogeneous": false,
        "lastTicketingDate": "2025-05-01",
        "itineraries": [
          {
            "segments": [
              {
                "departure": {
                  "iataCode": "",
                  "terminal": "",
                  "at": "2025-05-01T00:00:00"
                },
                "arrival": {
                  "iataCode": "",
                  "terminal": "",
                  "at": "2025-05-01T01:00:00"
                },
                "carrierCode": "AS",
                "number": "AS435",
                "aircraft": {
                  "code": "320"
                },
                "operating": {
                  "carrierCode": "AS"
                },
                "duration": "PT2H",
                "id": "1",
                "numberOfStops": 0
              }
            ]
          }
        ],
        "price": {
          "currency": "EUR",
          "total": "0.00",
          "base": "0.00",
          "grandTotal": "0.00"
        },
        "pricingOptions": {
          "fareType": [
            "PUBLISHED"
          ],
          "includedCheckedBagsOnly": false
        },
        "validatingAirlineCodes": [
          "AS"
        ],
        "travelerPricings": [
          {
            "travelerId": "1",
            "fareOption": "STANDARD",
            "travelerType": "ADULT",
            "price": {
              "currency": "EUR",
              "total": "0.00",
              "base": "0.00"
            },
            "fareDetailsBySegment": [
              {
                "segmentId": "1",
                "cabin": "ECONOMY",
                "fareBasis": "YFFBR",
                "class": "Y",
                "includedCheckedBags": {
                  "quantity": 0
                }
              }
            ]
          }
        ]
      }
    ],
    "travelers": [
      {
        "id": "1",
        "dateOfBirth": "2000-01-01",
        "name": {
          "firstName": "ak",
          "lastName": "ak"
        },
        "gender": "MALE",
        "contact": {
          "emailAddress": "ak@ak.com",
          "phones": [
            {
              "deviceType": "MOBILE",
              "countryCallingCode": "1",
              "number": "99999999"
            }
          ]
        }
      }
    ],
    "ticketingAgreement": {
      "option": "DELAY_TO_CANCEL",
      "delay": "6D"
    }
  }
}
2025-03-27 04:22:07,922 | amadeus_booking | INFO | Sending booking request to https://test.api.amadeus.com/v1/booking/flight-orders
2025-03-27 04:22:08,828 | amadeus_booking | INFO | Booking API response: HTTP 400
2025-03-27 04:22:08,830 | amadeus_booking | INFO | Raw API response saved to api_responses/booking_20250327_042208.txt
2025-03-27 04:22:08,830 | amadeus_booking | ERROR | API errors: Booking failed: departure iataCode must be a 3-letter code (Code: 477, Path: /data/flightOffers[0]/itineraries[0]/segments[0]/departure/iataCode); arrival iataCode must be a 3-letter code (Code: 477, Path: /data/flightOffers[0]/itineraries[0]/segments[0]/arrival/iataCode)
2025-03-27 04:22:08,830 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:08,831 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCTLXT_20250327_042208.json
2025-03-27 04:22:08,832 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:08,836 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:08,837 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:08,837 | amadeus_booking | ERROR | Booking failed with status code 400: {"errors":[{"status":400,"code":477,"title":"INVALID FORMAT","detail":"departure iataCode must be a 3-letter code","source":{"pointer":"/data/flightOffers[0]/itineraries[0]/segments[0]/departure/iataCode","example":"ORY"}},{"status":400,"code":477,"title":"INVALID FORMAT","detail":"arrival iataCode must be a 3-letter code","source":{"pointer":"/data/flightOffers[0]/itineraries[0]/segments[0]/arrival/iataCode","example":"ORY"}}]}
2025-03-27 04:22:08,837 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:08,838 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCJIKF_20250327_042208.json
2025-03-27 04:22:08,839 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:08,840 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:08,843 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:08,843 | amadeus_booking | ERROR | Unexpected error: local variable 'random' referenced before assignment
2025-03-27 04:22:08,843 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:08,843 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCDN16_20250327_042208.json
2025-03-27 04:22:08,844 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:08,845 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:08,846 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:08,857 | amadeus_booking | INFO | 
===== BOOKING FLIGHT =====
2025-03-27 04:22:08,857 | amadeus_booking | INFO | Flight booking requested
2025-03-27 04:22:08,857 | amadeus_booking | INFO | Getting Amadeus API access token
2025-03-27 04:22:09,654 | amadeus_booking | INFO | Got access token: zJkRBYeZ1a...
2025-03-27 04:22:09,655 | amadeus_booking | WARNING | No previous search data available to find original offer
2025-03-27 04:22:09,655 | amadeus_booking | INFO | Creating flight offer from provided details
2025-03-27 04:22:09,655 | amadeus_booking | INFO | Created flight offer with carrier: AS, flight: AS435, from:  to: 
2025-03-27 04:22:09,656 | amadeus_booking | INFO | Booking payload: {
  "data": {
    "type": "flight-order",
    "flightOffers": [
      {
        "type": "flight-offer",
        "id": "1",
        "source": "GDS",
        "instantTicketingRequired": false,
        "nonHomogeneous": false,
        "lastTicketingDate": "2025-05-01",
        "itineraries": [
          {
            "segments": [
              {
                "departure": {
                  "iataCode": "",
                  "terminal": "",
                  "at": "2025-05-01T00:00:00"
                },
                "arrival": {
                  "iataCode": "",
                  "terminal": "",
                  "at": "2025-05-01T01:00:00"
                },
                "carrierCode": "AS",
                "number": "AS435",
                "aircraft": {
                  "code": "320"
                },
                "operating": {
                  "carrierCode": "AS"
                },
                "duration": "PT2H",
                "id": "1",
                "numberOfStops": 0
              }
            ]
          }
        ],
        "price": {
          "currency": "EUR",
          "total": "0.00",
          "base": "0.00",
          "grandTotal": "0.00"
        },
        "pricingOptions": {
          "fareType": [
            "PUBLISHED"
          ],
          "includedCheckedBagsOnly": false
        },
        "validatingAirlineCodes": [
          "AS"
        ],
        "travelerPricings": [
          {
            "travelerId": "1",
            "fareOption": "STANDARD",
            "travelerType": "ADULT",
            "price": {
              "currency": "EUR",
              "total": "0.00",
              "base": "0.00"
            },
            "fareDetailsBySegment": [
              {
                "segmentId": "1",
                "cabin": "ECONOMY",
                "fareBasis": "YFFBR",
                "class": "Y",
                "includedCheckedBags": {
                  "quantity": 0
                }
              }
            ]
          }
        ]
      }
    ],
    "travelers": [
      {
        "id": "1",
        "dateOfBirth": "2000-01-01",
        "name": {
          "firstName": "ak",
          "lastName": "ak"
        },
        "gender": "MALE",
        "contact": {
          "emailAddress": "ak@ak.com",
          "phones": [
            {
              "deviceType": "MOBILE",
              "countryCallingCode": "1",
              "number": "99999999"
            }
          ]
        }
      }
    ],
    "ticketingAgreement": {
      "option": "DELAY_TO_CANCEL",
      "delay": "6D"
    }
  }
}
2025-03-27 04:22:09,656 | amadeus_booking | INFO | Sending booking request to https://test.api.amadeus.com/v1/booking/flight-orders
2025-03-27 04:22:10,623 | amadeus_booking | INFO | Booking API response: HTTP 400
2025-03-27 04:22:10,626 | amadeus_booking | INFO | Raw API response saved to api_responses/booking_20250327_042210.txt
2025-03-27 04:22:10,626 | amadeus_booking | ERROR | API errors: Booking failed: departure iataCode must be a 3-letter code (Code: 477, Path: /data/flightOffers[0]/itineraries[0]/segments[0]/departure/iataCode); arrival iataCode must be a 3-letter code (Code: 477, Path: /data/flightOffers[0]/itineraries[0]/segments[0]/arrival/iataCode)
2025-03-27 04:22:10,626 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:10,627 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCFXXV_20250327_042210.json
2025-03-27 04:22:10,630 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:10,633 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:10,634 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:10,635 | amadeus_booking | ERROR | Booking failed with status code 400: {"errors":[{"status":400,"code":477,"title":"INVALID FORMAT","detail":"departure iataCode must be a 3-letter code","source":{"pointer":"/data/flightOffers[0]/itineraries[0]/segments[0]/departure/iataCode","example":"ORY"}},{"status":400,"code":477,"title":"INVALID FORMAT","detail":"arrival iataCode must be a 3-letter code","source":{"pointer":"/data/flightOffers[0]/itineraries[0]/segments[0]/arrival/iataCode","example":"ORY"}}]}
2025-03-27 04:22:10,635 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:10,637 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCJL43_20250327_042210.json
2025-03-27 04:22:10,639 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:10,642 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:10,643 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:10,643 | amadeus_booking | ERROR | Unexpected error: local variable 'random' referenced before assignment
2025-03-27 04:22:10,643 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:10,644 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCCI5E_20250327_042210.json
2025-03-27 04:22:10,645 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:10,647 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:10,649 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:10,650 | amadeus_booking | INFO | 
===== BOOKING FLIGHT =====
2025-03-27 04:22:10,650 | amadeus_booking | INFO | Flight booking requested
2025-03-27 04:22:10,650 | amadeus_booking | INFO | Getting Amadeus API access token
2025-03-27 04:22:11,315 | amadeus_booking | INFO | Got access token: ZfqpfrPAmA...
2025-03-27 04:22:11,315 | amadeus_booking | WARNING | No previous search data available to find original offer
2025-03-27 04:22:11,316 | amadeus_booking | INFO | Creating flight offer from provided details
2025-03-27 04:22:11,316 | amadeus_booking | INFO | Created flight offer with carrier: AS, flight: AS435, from:  to: 
2025-03-27 04:22:11,316 | amadeus_booking | INFO | Booking payload: {
  "data": {
    "type": "flight-order",
    "flightOffers": [
      {
        "type": "flight-offer",
        "id": "1",
        "source": "GDS",
        "instantTicketingRequired": false,
        "nonHomogeneous": false,
        "lastTicketingDate": "2025-05-01",
        "itineraries": [
          {
            "segments": [
              {
                "departure": {
                  "iataCode": "",
                  "terminal": "",
                  "at": "2025-05-01T00:00:00"
                },
                "arrival": {
                  "iataCode": "",
                  "terminal": "",
                  "at": "2025-05-01T01:00:00"
                },
                "carrierCode": "AS",
                "number": "AS435",
                "aircraft": {
                  "code": "320"
                },
                "operating": {
                  "carrierCode": "AS"
                },
                "duration": "PT2H",
                "id": "1",
                "numberOfStops": 0
              }
            ]
          }
        ],
        "price": {
          "currency": "EUR",
          "total": "0.00",
          "base": "0.00",
          "grandTotal": "0.00"
        },
        "pricingOptions": {
          "fareType": [
            "PUBLISHED"
          ],
          "includedCheckedBagsOnly": false
        },
        "validatingAirlineCodes": [
          "AS"
        ],
        "travelerPricings": [
          {
            "travelerId": "1",
            "fareOption": "STANDARD",
            "travelerType": "ADULT",
            "price": {
              "currency": "EUR",
              "total": "0.00",
              "base": "0.00"
            },
            "fareDetailsBySegment": [
              {
                "segmentId": "1",
                "cabin": "ECONOMY",
                "fareBasis": "YFFBR",
                "class": "Y",
                "includedCheckedBags": {
                  "quantity": 0
                }
              }
            ]
          }
        ]
      }
    ],
    "travelers": [
      {
        "id": "1",
        "dateOfBirth": "2000-01-01",
        "name": {
          "firstName": "ak",
          "lastName": "ak"
        },
        "gender": "MALE",
        "contact": {
          "emailAddress": "ak@ak.com",
          "phones": [
            {
              "deviceType": "MOBILE",
              "countryCallingCode": "1",
              "number": "99999999"
            }
          ]
        }
      }
    ],
    "ticketingAgreement": {
      "option": "DELAY_TO_CANCEL",
      "delay": "6D"
    }
  }
}
2025-03-27 04:22:11,317 | amadeus_booking | INFO | Sending booking request to https://test.api.amadeus.com/v1/booking/flight-orders
2025-03-27 04:22:12,271 | amadeus_booking | INFO | Booking API response: HTTP 400
2025-03-27 04:22:12,274 | amadeus_booking | INFO | Raw API response saved to api_responses/booking_20250327_042212.txt
2025-03-27 04:22:12,274 | amadeus_booking | ERROR | API errors: Booking failed: departure iataCode must be a 3-letter code (Code: 477, Path: /data/flightOffers[0]/itineraries[0]/segments[0]/departure/iataCode); arrival iataCode must be a 3-letter code (Code: 477, Path: /data/flightOffers[0]/itineraries[0]/segments[0]/arrival/iataCode)
2025-03-27 04:22:12,274 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:12,275 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CC0RKJ_20250327_042212.json
2025-03-27 04:22:12,277 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:12,281 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:12,282 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:12,283 | amadeus_booking | ERROR | Booking failed with status code 400: {"errors":[{"status":400,"code":477,"title":"INVALID FORMAT","detail":"departure iataCode must be a 3-letter code","source":{"pointer":"/data/flightOffers[0]/itineraries[0]/segments[0]/departure/iataCode","example":"ORY"}},{"status":400,"code":477,"title":"INVALID FORMAT","detail":"arrival iataCode must be a 3-letter code","source":{"pointer":"/data/flightOffers[0]/itineraries[0]/segments[0]/arrival/iataCode","example":"ORY"}}]}
2025-03-27 04:22:12,283 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:12,284 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CC28OD_20250327_042212.json
2025-03-27 04:22:12,285 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:12,289 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:12,289 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:12,290 | amadeus_booking | ERROR | Unexpected error: local variable 'random' referenced before assignment
2025-03-27 04:22:12,290 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:12,290 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCUU4I_20250327_042212.json
2025-03-27 04:22:12,291 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:12,294 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:12,296 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:12,302 | amadeus_booking | INFO | 
===== BOOKING FLIGHT =====
2025-03-27 04:22:12,302 | amadeus_booking | INFO | Flight booking requested
2025-03-27 04:22:12,302 | amadeus_booking | INFO | Getting Amadeus API access token
2025-03-27 04:22:13,026 | amadeus_booking | INFO | Got access token: vAN4HnJRG1...
2025-03-27 04:22:13,027 | amadeus_booking | WARNING | No previous search data available to find original offer
2025-03-27 04:22:13,027 | amadeus_booking | INFO | Creating flight offer from provided details
2025-03-27 04:22:13,028 | amadeus_booking | INFO | Created flight offer with carrier: AS, flight: AS435, from:  to: 
2025-03-27 04:22:13,028 | amadeus_booking | INFO | Booking payload: {
  "data": {
    "type": "flight-order",
    "flightOffers": [
      {
        "type": "flight-offer",
        "id": "1",
        "source": "GDS",
        "instantTicketingRequired": false,
        "nonHomogeneous": false,
        "lastTicketingDate": "2025-05-01",
        "itineraries": [
          {
            "segments": [
              {
                "departure": {
                  "iataCode": "",
                  "terminal": "",
                  "at": "2025-05-01T00:00:00"
                },
                "arrival": {
                  "iataCode": "",
                  "terminal": "",
                  "at": "2025-05-01T01:00:00"
                },
                "carrierCode": "AS",
                "number": "AS435",
                "aircraft": {
                  "code": "320"
                },
                "operating": {
                  "carrierCode": "AS"
                },
                "duration": "PT2H",
                "id": "1",
                "numberOfStops": 0
              }
            ]
          }
        ],
        "price": {
          "currency": "EUR",
          "total": "0.00",
          "base": "0.00",
          "grandTotal": "0.00"
        },
        "pricingOptions": {
          "fareType": [
            "PUBLISHED"
          ],
          "includedCheckedBagsOnly": false
        },
        "validatingAirlineCodes": [
          "AS"
        ],
        "travelerPricings": [
          {
            "travelerId": "1",
            "fareOption": "STANDARD",
            "travelerType": "ADULT",
            "price": {
              "currency": "EUR",
              "total": "0.00",
              "base": "0.00"
            },
            "fareDetailsBySegment": [
              {
                "segmentId": "1",
                "cabin": "ECONOMY",
                "fareBasis": "YFFBR",
                "class": "Y",
                "includedCheckedBags": {
                  "quantity": 0
                }
              }
            ]
          }
        ]
      }
    ],
    "travelers": [
      {
        "id": "1",
        "dateOfBirth": "2000-01-01",
        "name": {
          "firstName": "ak",
          "lastName": "ak"
        },
        "gender": "MALE",
        "contact": {
          "emailAddress": "ak@ak.com",
          "phones": [
            {
              "deviceType": "MOBILE",
              "countryCallingCode": "1",
              "number": "99999999"
            }
          ]
        }
      }
    ],
    "ticketingAgreement": {
      "option": "DELAY_TO_CANCEL",
      "delay": "6D"
    }
  }
}
2025-03-27 04:22:13,028 | amadeus_booking | INFO | Sending booking request to https://test.api.amadeus.com/v1/booking/flight-orders
2025-03-27 04:22:13,941 | amadeus_booking | INFO | Booking API response: HTTP 400
2025-03-27 04:22:13,944 | amadeus_booking | INFO | Raw API response saved to api_responses/booking_20250327_042213.txt
2025-03-27 04:22:13,944 | amadeus_booking | ERROR | API errors: Booking failed: departure iataCode must be a 3-letter code (Code: 477, Path: /data/flightOffers[0]/itineraries[0]/segments[0]/departure/iataCode); arrival iataCode must be a 3-letter code (Code: 477, Path: /data/flightOffers[0]/itineraries[0]/segments[0]/arrival/iataCode)
2025-03-27 04:22:13,944 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:13,945 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCNQL7_20250327_042213.json
2025-03-27 04:22:13,947 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:13,952 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:13,953 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:13,954 | amadeus_booking | ERROR | Booking failed with status code 400: {"errors":[{"status":400,"code":477,"title":"INVALID FORMAT","detail":"departure iataCode must be a 3-letter code","source":{"pointer":"/data/flightOffers[0]/itineraries[0]/segments[0]/departure/iataCode","example":"ORY"}},{"status":400,"code":477,"title":"INVALID FORMAT","detail":"arrival iataCode must be a 3-letter code","source":{"pointer":"/data/flightOffers[0]/itineraries[0]/segments[0]/arrival/iataCode","example":"ORY"}}]}
2025-03-27 04:22:13,954 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:13,956 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCI377_20250327_042213.json
2025-03-27 04:22:13,957 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:13,961 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:13,962 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:13,962 | amadeus_booking | ERROR | Unexpected error: local variable 'random' referenced before assignment
2025-03-27 04:22:13,963 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:13,963 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCAG9K_20250327_042213.json
2025-03-27 04:22:13,964 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:13,967 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:13,969 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:13,970 | amadeus_booking | INFO | 
===== BOOKING FLIGHT =====
2025-03-27 04:22:13,970 | amadeus_booking | INFO | Flight booking requested
2025-03-27 04:22:13,970 | amadeus_booking | INFO | Getting Amadeus API access token
2025-03-27 04:22:14,832 | amadeus_booking | INFO | Got access token: e6FGoMQxD3...
2025-03-27 04:22:14,833 | amadeus_booking | WARNING | No previous search data available to find original offer
2025-03-27 04:22:14,833 | amadeus_booking | INFO | Creating flight offer from provided details
2025-03-27 04:22:14,833 | amadeus_booking | INFO | Created flight offer with carrier: AS, flight: AS435, from:  to: 
2025-03-27 04:22:14,834 | amadeus_booking | INFO | Booking payload: {
  "data": {
    "type": "flight-order",
    "flightOffers": [
      {
        "type": "flight-offer",
        "id": "1",
        "source": "GDS",
        "instantTicketingRequired": false,
        "nonHomogeneous": false,
        "lastTicketingDate": "2025-05-01",
        "itineraries": [
          {
            "segments": [
              {
                "departure": {
                  "iataCode": "",
                  "terminal": "",
                  "at": "2025-05-01T00:00:00"
                },
                "arrival": {
                  "iataCode": "",
                  "terminal": "",
                  "at": "2025-05-01T01:00:00"
                },
                "carrierCode": "AS",
                "number": "AS435",
                "aircraft": {
                  "code": "320"
                },
                "operating": {
                  "carrierCode": "AS"
                },
                "duration": "PT2H",
                "id": "1",
                "numberOfStops": 0
              }
            ]
          }
        ],
        "price": {
          "currency": "EUR",
          "total": "0.00",
          "base": "0.00",
          "grandTotal": "0.00"
        },
        "pricingOptions": {
          "fareType": [
            "PUBLISHED"
          ],
          "includedCheckedBagsOnly": false
        },
        "validatingAirlineCodes": [
          "AS"
        ],
        "travelerPricings": [
          {
            "travelerId": "1",
            "fareOption": "STANDARD",
            "travelerType": "ADULT",
            "price": {
              "currency": "EUR",
              "total": "0.00",
              "base": "0.00"
            },
            "fareDetailsBySegment": [
              {
                "segmentId": "1",
                "cabin": "ECONOMY",
                "fareBasis": "YFFBR",
                "class": "Y",
                "includedCheckedBags": {
                  "quantity": 0
                }
              }
            ]
          }
        ]
      }
    ],
    "travelers": [
      {
        "id": "1",
        "dateOfBirth": "2000-01-01",
        "name": {
          "firstName": "ak",
          "lastName": "ak"
        },
        "gender": "MALE",
        "contact": {
          "emailAddress": "ak@ak.com",
          "phones": [
            {
              "deviceType": "MOBILE",
              "countryCallingCode": "1",
              "number": "99999999"
            }
          ]
        }
      }
    ],
    "ticketingAgreement": {
      "option": "DELAY_TO_CANCEL",
      "delay": "6D"
    }
  }
}
2025-03-27 04:22:14,834 | amadeus_booking | INFO | Sending booking request to https://test.api.amadeus.com/v1/booking/flight-orders
2025-03-27 04:22:15,824 | amadeus_booking | INFO | Booking API response: HTTP 400
2025-03-27 04:22:15,826 | amadeus_booking | INFO | Raw API response saved to api_responses/booking_20250327_042215.txt
2025-03-27 04:22:15,826 | amadeus_booking | ERROR | API errors: Booking failed: departure iataCode must be a 3-letter code (Code: 477, Path: /data/flightOffers[0]/itineraries[0]/segments[0]/departure/iataCode); arrival iataCode must be a 3-letter code (Code: 477, Path: /data/flightOffers[0]/itineraries[0]/segments[0]/arrival/iataCode)
2025-03-27 04:22:15,826 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:15,827 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CC9WH0_20250327_042215.json
2025-03-27 04:22:15,828 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:15,834 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:15,835 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:15,836 | amadeus_booking | ERROR | Booking failed with status code 400: {"errors":[{"status":400,"code":477,"title":"INVALID FORMAT","detail":"departure iataCode must be a 3-letter code","source":{"pointer":"/data/flightOffers[0]/itineraries[0]/segments[0]/departure/iataCode","example":"ORY"}},{"status":400,"code":477,"title":"INVALID FORMAT","detail":"arrival iataCode must be a 3-letter code","source":{"pointer":"/data/flightOffers[0]/itineraries[0]/segments[0]/arrival/iataCode","example":"ORY"}}]}
2025-03-27 04:22:15,836 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:15,836 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CC1A93_20250327_042215.json
2025-03-27 04:22:15,837 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:15,846 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:15,848 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
2025-03-27 04:22:15,848 | amadeus_booking | ERROR | Unexpected error: local variable 'random' referenced before assignment
2025-03-27 04:22:15,848 | amadeus_booking | INFO | Creating mock booking
2025-03-27 04:22:15,848 | amadeus_booking | INFO | Saved mock booking data to bookings/ORDER_CCUJ9P_20250327_042215.json
2025-03-27 04:22:15,849 | amadeus_booking | ERROR | Error generating e-ticket PDF: 'str' object has no attribute 'get'
2025-03-27 04:22:15,853 | amadeus_booking | ERROR | Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 193, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/tool_usage.py", line 190, in _use
    result = tool.invoke(input=arguments)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/.venv/lib/python3.10/site-packages/crewai/tools/structured_tool.py", line 236, in invoke
    return self.func(**parsed_args, **kwargs)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 838, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 811, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 858, in _create_mock_booking
    return self._format_booking_results(mock_booking["data"])
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 1017, in _format_booking_results
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 817, in _run
    return self._create_mock_booking(flight_offer, traveler_info)
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/amadeus_booking_tool.py", line 910, in _create_mock_booking
    pnr = ''.join(random.choices(string.ascii_uppercase, k=6))
UnboundLocalError: local variable 'random' referenced before assignment

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/skep/Documents/Masumi Node/Agents/TravelAI/travelai/src/travelai/tools/mock_booking_handler.py", line 408, in generate_eticket_pdf
    currency = price.get("currency", "")
AttributeError: 'str' object has no attribute 'get'

2025-03-27 04:22:15,856 | amadeus_booking | ERROR | Error creating mock booking: 'str' object has no attribute 'get'
